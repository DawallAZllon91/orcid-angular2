# Internationalization

There are are two types of translation the ones that are located in the HTML of the components (static translations) and the ones that must exist in the TypeScript code of the components (dynamic translations). Both are handled slightly differently in the application.

## Static translations:

TODO: REQUIRES UPDATE AFTER TRANSLATIONS ARE MOVED TO ORCID ANGULAR @leomendoza123

For any HTML tag that contains text only like the following

```
<button>MORE NEWS</button>

```

A translation tag can be added

```
<button i18n="@@home.more_news">MORE NEWS</button>
```

On build time this is going to change the contained text for the value of the matching translation key `home.more_news` for all the supported languages defined on the [orcid Source translations files](https://github.com/ORCID/ORCID-Source/tree/master/orcid-core/src/main/resources/i18n). Please note that the HTML value itself is going to be overwritten meaning that all the translation processing required is executed only during compilation.

## Dynamic translations

_The methods described for dynamic translations on this document
will slightly change on **Angular 9** since it adds support for
translations inside TypeScript files._

Generally is better to avoid the use of dynamic translations, since static translations are very efficient. But sometimes some scenarios require more flexibility and the text content must exist inside the component scripting.

To make this possible first a static translation must be created inside the file `/src/locale/i18n.pseudo.component.html`

For instance, add the following line

```
<var i18n="@@home.more_news">MORE NEWS</var>
```

Build the translations

```
yarn build:i18n
```

And now the new translation is available on the `\src\locale\messages.dynamic.en.ts` file, so it can be used inside the TS code

```

import { LOCALE } from '../../../locale/messages.dynamic.en'
....
let text= LOCALE['home.more_news']

```

On build time this imported translation file is going to be automatically swapped for each language.

## Adding new translations properties files

TODO: REQUIRES UPDATE AFTER TRANSLATIONS ARE MOVED TO ORCID ANGULAR @leomendoza123

For every feature module a translation file should exist on the (orcid source properties folder)[https://github.com/ORCID/ORCID-Source/tree/master/orcid-core/src/main/resources/i18n] with the following name standard:

```
ng_orcid_<camel case module name>_en.properties
```

- to do it follow the [add a resource guide](https://github.com/ORCID/ORCID-Source/blob/ff5a96542d40df534cfdf4f2a176bb7f1e95c6d8/orcid-core/src/main/resources/i18n/README.md#add-a-resource)
- add the new translation file URL to the `baseGithubTranslationFilesURL` array on the [/scripts/translate-file-generator.prebuild.ts](https://github.com/ORCID/orcid-angular/blob/master/scripts/translate-file-generator.prebuild.ts) script

Please read how to [test translations on an Orcid-Source brach](#test-translations-on-an-orcid-source-brach)

## Adding and updating new string to a properties file

TODO: REQUIRES UPDATE AFTER TRANSLATIONS ARE MOVED TO ORCID ANGULAR @leomendoza123

You can add new strings to properties files in English as new properties are required for the app, after that, you need to follow the [add new strings guide](https://github.com/ORCID/ORCID-Source/blob/ff5a96542d40df534cfdf4f2a176bb7f1e95c6d8/orcid-core/src/main/resources/i18n/README.md#add-new-strings) or you can update existing strings using the [update existing strings guide](https://github.com/ORCID/ORCID-Source/blob/master/orcid-core/src/main/resources/i18n/README.md#update-existing-strings----english-only-or-english--other-languages)

Please read how to [test translations on an Orcid-Source brach](#test-translations-on-an-orcid-source-brach)

## Build time modifications

It is possible to apply modifications to the text on compilation time.
For instance, adding the key `#upperCase` before the translation key

```
<button i18n="#upperCase@@helloWorld">Hello!</button>
```

Will transform the translated text on every language to uppercase before using it to build the application.

The following transformations keys are available

| Key           | Initial text  | Processed text |
| ------------- | ------------- | -------------- |
| #upperCase    | test          | TEST           |
| #lowerCase    | TEST          | test           |
| #titleCase    | test tile     | Test Tile      |
| #sentenceCase | test sentence | Test sentence  |

If more preprocessing methods are required those can be added on the function `translationTreatment` on `/src/locale/translate-file-generator.ts`

## Clone properties from Orcid Source

With new strings added to Orcid Angular, it is possible to clone the translations for the same strings on Orcid Source.

For this, the translation should meet the following conditions

- The property on Orcid Angular doesn't have a translation for some or all languages
- The English text of the property on Orcid Angular and Orcid Source are the exact same

To do this call the following script `yarn build:i18n:clone '<orcid-angular local folder>' '<orcid source i18n folder>'`

for instance:

```
yarn build:i18n:clone 'D:/workspace/orcid-angular/src/locale/properties' 'D:/workspace/ORCID-Source/orcid-core/src/main/resources/i18n'
```

This will create a temp folder on the root of the project, with all the translations files, from that folder the required translations files can be copied and pasted on orcid angular local/properties folder. This should be done carefully since not just because the English version of a string match between Orcid Source and Orcid Angular means that the same translation is correct for all languages.

## Debugging translations

To find possible problems on translations the file `src\locale\messages.translation.log.json` is generated on compilation time, or by just running `yarn build:i18n`. It contains a list of objects for every supported i18n code with the following parameters:

| Parameter       | Description                                                                                                                                                                                                                                                                                                                                           |
| --------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| notFound        | A list of unexisting translation IDs on the properties files.                                                                                                                                                                                                                                                                                         |
| unexistingFiles | A list of unexisting file URLs on [Orcid Source repo](https://github.com/ORCID/ORCID-Source/tree/master/orcid-core/src/main/resources/i18n) that were expected for the language.                                                                                                                                                                      |
| changed         | A list of objects that represent the translations that were altered through the script. Each contains the translation `id`, the original `translation` on the properties files, and the `replacement` that the script sets.                                                                                                                           |
| unmatch         | This parameter can only be present on the English language `en`, it shows which translations do not match between the templates and the English properties files. Each contains the `id` of the translation, `textOnTemplate` and `textOnProperty` This is the best way to find translation keys which value doesn't match the value on the template. |

## Testing translations locally

To test translations it is required to serve the application with AOT compilation. For this, please make sure to build the translations with `yarn build:i18n` and call any of the scripts for the supported languages.

```
yarn start:en ## Runs the application in using the english properties
yarn start:fr ## Runs the application in using the french properties
yarn start:ar ## Runs the application in using the arabic properties
yarn start:es ## Runs the application in using the spanish properties
yarn start:ca ## ... and so on
yarn start:cs
yarn start:it
yarn start:ja
yarn start:pt
yarn start:ru
yarn start:uk
yarn start:zh_CN
yarn start:zh_TW
yarn start:lr ## These last fourth configurations are used only for testing
yarn start:rl
yarn start:xx
yarn start:source
```

#### Test translations on an Orcid-Source brach

TODO: REQUIRES UPDATE AFTER TRANSLATIONS ARE MOVED TO ORCID ANGULAR @leomendoza123

Please note that when you add new strings on Orcid-Source properties you are not going to be able to test the changes until those are merged into master. As a temporal solution, you can simply edit the `baseGithubTranslationFilesURL` array on the [/scripts/translate-file-generator.prebuild.ts](https://github.com/ORCID/orcid-angular/blob/master/scripts/translate-file-generator.prebuild.ts) file to build translations base on your branch instead of master.

After that run

```
yarn build:18n
```
