<!-- The following line is a temporall soting test button -->
<!-- <div (click)="testSorting()">Temp test sort</div> -->
<mat-accordion [multi]="true" @parentListAnimation>
  <ng-container
    *ngFor="
      let affiliationGroup of profileAffiliationUiGroups;
      trackBy: trackByProfileAffiliationUiGroups
    "
  >
    <mat-expansion-panel
      *ngIf="affiliationGroup.affiliationGroup.length"
      (opened)="panelState[affiliationGroup.type] = true"
      (closed)="panelState[affiliationGroup.type] = false"
      [expanded]="panelState[affiliationGroup.type]"
    >
      <mat-expansion-panel-header class="mat-expansion-header">
        <h2 class="mat-subheading-2">
          <!--
            The translation of the header of each card is handle with a separate template #translatedHeader
          -->
          <ng-container
            [ngTemplateOutlet]="translatedHeader"
            [ngTemplateOutletContext]="{ affiliationGroup: affiliationGroup }"
          >
          </ng-container>
        </h2>
        <h2 class="mat-subheading-2 itemsAmount">
          ({{ affiliationGroup.affiliationGroup.length }})
        </h2>
      </mat-expansion-panel-header>

      <div
        [@childListAnimation]="
          affiliationGroup.affiliationGroup[0].groupId +
          affiliationGroup.affiliationGroup.length
        "
      >
        <app-profile-records-wrapper-affiliations
          *ngFor="
            let affiliation of affiliationGroup.affiliationGroup;
            trackBy: trackByAffiliationGroup
          "
          [affiliation]="affiliation"
          [id]="id"
        ></app-profile-records-wrapper-affiliations>
      </div>
    </mat-expansion-panel>
  </ng-container>
  <!--
    _______________________________________________________________________________________________
  -->

  <mat-expansion-panel
    *ngIf="profileWorks.groups.length"
    (opened)="panelState['works'] = true"
    (closed)="panelState['works'] = false"
    [expanded]="true"
  >
    <mat-expansion-panel-header class="mat-expansion-header">
      <h2 class="mat-subheading-2" #worksExpansionPanel>
        <!--
          The translation of the header of each card is handle with a separate template #translatedHeader
        -->
        <ng-container [ngTemplateOutlet]="translatedHeaderWorks">
        </ng-container>
      </h2>
      <h2 class="mat-subheading-2 itemsAmount">
        ({{ profileWorks.totalGroups }})
      </h2>
    </mat-expansion-panel-header>
    <mat-paginator
      *ngIf="profileWorks.totalGroups > 50"
      [length]="profileWorks.totalGroups"
      (page)="worksPagesChange($event)"
      [pageIndex]="worksPageIndex"
    >
    </mat-paginator>

    <ng-container *ngIf="!profileWorksLoading">
      <div
        [@childListAnimation]="
          profileWorks.groups[0].defaultPutCode + profileWorks.groups[0].length
        "
      >
        <app-profile-records-wrapper-works
          *ngFor="let profileworksStack of profileWorks.groups"
          [profileworksStack]="profileworksStack"
          [id]="id"
        >
        </app-profile-records-wrapper-works>
      </div>
    </ng-container>

    <div class="progress-spinner-container" *ngIf="profileWorksLoading">
      <mat-progress-spinner color="primary" mode="indeterminate">
      </mat-progress-spinner>
    </div>

    <mat-paginator
      *ngIf="profileWorks.totalGroups > 50"
      [length]="profileWorks.totalGroups"
      (page)="worksPagesChange($event)"
      [pageIndex]="worksPageIndex"
    >
    </mat-paginator>
  </mat-expansion-panel>
</mat-accordion>

<!--
  I18N translation labels
  TODO: Explain the use of these labels
  _______________________________________________________________________________________________
-->

<ng-template #translatedHeader let-affiliationGroup="affiliationGroup">
  <ng-container
    *ngIf="affiliationGroup.type == affiliationUIGroupsTypes.EMPLOYMENT"
    i18n="@@org.orcid.jaxb.model.message.AffiliationType.employment"
  >
    Employment</ng-container
  >
  <ng-container
    *ngIf="
      affiliationGroup.type ==
      affiliationUIGroupsTypes.EDUCATION_AND_QUALIFICATION
    "
    i18n="@@org.orcid.jaxb.model.message.AffiliationType.education_qualification"
  >
    Education and qualifications</ng-container
  >
  <ng-container
    *ngIf="
      affiliationGroup.type ==
      affiliationUIGroupsTypes.INVITED_POSITION_AND_DISTINCTION
    "
    i18n="@@org.orcid.jaxb.model.message.AffiliationType.distinction_invited_position"
  >
    Invited positions and distinctions</ng-container
  >
  <ng-container
    *ngIf="
      affiliationGroup.type == affiliationUIGroupsTypes.MEMBERSHIP_AND_SERVICE
    "
    i18n="@@org.orcid.jaxb.model.message.AffiliationType.membership_service"
  >
    Membership and service</ng-container
  >
</ng-template>

<ng-template #translatedHeaderWorks i18n="@@notifications.works_label">
  Works
</ng-template>

<!--
  TODO The following translations files are for mat-paginator
  but these ones are required to be provided through a service
  https://github.com/angular/material2/issues/8239

  This requires the translation string to be declared outside the templates
  There is a currently open issue about this open on the Angular Repo
  https://github.com/angular/angular/issues/11405

  While Angular have no support for outside template translations an external library
  like https://github.com/ngx-translate/i18n-polyfill might be applied.
-->

<ng-template #paginatorNextPageLabel i18n="@@ng-orcid.paginatorNextPageLabel">
  Next page
</ng-template>

<ng-template #paginatorLastPageLabel i18n="@@ng-orcid.paginatorLastPageLabel">
  Previous page
</ng-template>

<ng-template #paginatorFirstPageLabel i18n="@@ng-orcid.paginatorFirstPageLabel">
  First page
</ng-template>

<ng-template
  #paginatorPreviousPageLabel
  i18n="@@ng-orcid.paginatorPreviousPageLabel"
>
  Last page
</ng-template>

<ng-template
  #paginatorItemsPerPageLabel
  i18n="@@ng-orcid.paginatorItemsPerPageLabel"
>
  Items per page
</ng-template>

<ng-template #paginatoOf i18n="@@ng-orcid.paginatoOf"> of </ng-template>
