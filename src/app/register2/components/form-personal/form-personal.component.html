<ng-container [formGroup]="form">
  <h2 i18n="@@register.yourNames" class="orc-font-body">Your names</h2>


  <div class="input-container">
    <mat-label i18n="@@register.givenNames" class="orc-font-small-print"
      [ngClass]="{'error': form.controls.givenNames.touched && form.controls.givenNames.errors}">Given names</mat-label>
    <mat-form-field appearance="outline" [hideRequiredMarker]="true" async>
      <input id="given-names-input" formControlName="givenNames" matInput #firstInput
        [attr.placeholder]="labelNameYouMostCommonly" />
    </mat-form-field>

    <mat-error *ngIf="form.controls.givenNames.touched && form.hasError('required', 'givenNames')"
      i18n="@@register.firstNamePassword">
      Please enter your first/given name
    </mat-error>
    <mat-error *ngIf="form.hasError('illegalName', 'givenNames')" i18n="@@register.invalidName">
      Invalid name characters or format
    </mat-error>
    <mat-error *ngIf="form.hasError('backendError', 'givenNames')">
      <div *ngFor="let error of form.getError('backendError', 'givenNames')">
        <app-backend-error [errorCode]="error"></app-backend-error>
      </div>
    </mat-error>
  </div>
  <div class="input-container">

    <mat-label class="orc-font-small-print"><ng-container i18n="@@register.familyName">Family names</ng-container>
      <label i18n="@@register.optional">(Optional)</label></mat-label>
    <mat-form-field appearance="outline" [hideRequiredMarker]="true">

      <input id="family-names-input" formControlName="familyNames" matInput />
      <mat-error *ngIf="form.hasError('illegalName', 'familyNames')" i18n="@@register.invalidName">
        Invalid name characters or format
      </mat-error>
      <mat-error *ngIf="form.hasError('backendError', 'familyNames')">
        <div *ngFor="let error of form.getError('backendError', 'familyNames')">
          <app-backend-error [errorCode]="error"></app-backend-error>
        </div>
      </mat-error>
    </mat-form-field>
  </div>

  <h2 i18n="@@register.yourEmailAddresses" class="orc-font-body">Your email addresses</h2>
  <ng-container formGroupName="emails">
    <div class="input-container">

      <mat-label class="orc-font-small-print" class="orc-font-small-print"
        [ngClass]="{error: emailFormTouched && form.hasError('required', 'emails.email')}"
        i18n="@@register.primaryEmail">Email</mat-label>

      <mat-form-field appearance="outline" [hideRequiredMarker]="true">
        <input id="email-input" formControlName="email" matInput appTrim type="email" />
      </mat-form-field>
      <mat-error *ngIf="emailFormTouched && form.hasError('required', 'emails.email')"
        i18n="@@register.primaryEmailRequired">
        An email is required
      </mat-error>
      <mat-error *ngIf="
        this.emails.hasError('email', 'email') ||
        this.emails.hasError('pattern', 'email')
      " i18n="@@register.invalidEmail">
        Invalid email format
      </mat-error>

      <mat-error *ngIf="this.emails.hasError('backendError', 'email')">
        <div *ngFor="let error of this.emails.getError('backendError', 'email')">
          <app-backend-error [errorCode]="error" [value]="emails.get('email').value"></app-backend-error>
        </div>
      </mat-error>
    </div>

    <!-- <mat-label i18n="@@register.confirmEmail"
    >Confirm primary email</mat-label
  > -->
    <div class="input-container">

      <mat-form-field appearance="outline" *ngIf="!reactivation?.isReactivation" [hideRequiredMarker]="true">

        <input formControlName="confirmEmail" matInput (paste)="(false)" appTrim autocomplete="off" type="email"
          id="confirm-email-input" [attr.labelConfirmEmail]="labelConfirmEmail"
          [attr.placeholder]="labelConfirmEmail" />

      </mat-form-field>
      <mat-error *ngIf="emailConfirmationFormTouched && form.hasError('required', 'emails.confirmEmail')" i18n="@@register.confirmEmailRequired">
        Please confirm your email
      </mat-error>
      <mat-error *ngIf="
        this.emails.hasError('email', 'confirmEmail') ||
        this.emails.hasError('pattern', 'confirmEmail')
      " i18n="@@register.invalidEmail">
        Invalid email format
      </mat-error>
      <mat-error *ngIf="this.emails.hasError('mismatch', 'confirmEmail')" i18n="@@register.confirmationEmailNotMatch">
        Email confirmation does not match
      </mat-error>
      <mat-error *ngIf="this.emails.hasError('backendError', 'emails.confirmEmail')">
        <div *ngFor="
          let error of form.getError('backendError', 'emails.confirmEmail')
        ">
          <app-backend-error [errorCode]="error"></app-backend-error>
        </div>
      </mat-error>
    </div>

    <!-- ADDITIONAL EMAILS -->
    <app-form-personal-additional-emails [additionalEmails]="additionalEmails"></app-form-personal-additional-emails>
  </ng-container>
</ng-container>

<mde-popover #namesPopover="mdePopover" [mdePopoverOverlapTrigger]="false" [mdePopoverCloseOnClick]="true">
  <mat-card class="mat-elevation-z3 orcid-popover">
    <p i18n="@@register.firstNameDetail">
      First name is your given name or the name you most commonly go by.
    </p>
    <p i18n="@@register.lastNameDetail">Last name is your family name.</p>
    <p i18n="@@register.youWillHaveAChance">
      You will have a chance to add additional names after you have created your
      account.
    </p>
    <a href="https://support.orcid.org/hc/articles/360006973853"
      target="orcid.frontend.register.help.more_info.link.text" i18n="@@register.moreInfoOnNames">More information on
      names</a>
  </mat-card>
</mde-popover>