<app-panels
  *ngIf="userRecord && userRecord.peerReviews"
  class="row"
  [title]="ngOrcidPeerReview"
  [type]="'peer-review'"
  [total]="userRecord.peerReviews.length"
>
  <ng-container *ngFor="let peerReview of userRecord.peerReviews">
    <app-panel
      [elements]="peerReview"
      [type]="'top-bar'"
      [editable]="false"
      [openState]="false"
      class="top-bar"
    >
      <div header>
        <ng-container i18n="@@peerReview.reviewActivity">
          Review activity for
        </ng-container>
        <b>
          {{peerReview.name}}
        </b>
        ({{ peerReview.peerReviewDuplicateGroups.length }})
      </div>
      <app-panel-data
        class="orc-font-body-small"
      >
        <app-panel-element [hideVisibility]="false">
          <div class="description">
            <p>
              <span class="capitalize">{{ peerReview.type }}</span>, {{ peerReview.description }}
            </p>
            <ng-container *ngIf="peerReview.groupType">
              <p>
                {{ peerReview.groupType }}:
                <a href="{{ peerReview.url }}">
                  {{ peerReview.groupIdValue }}
                </a>
              </p>
            </ng-container>
          </div>
        </app-panel-element>
        <app-panel-element class="nested-panels" [hideVisibility]="false">
          <ng-container *ngFor="let subPeerReview of peerReview.peerReviewDuplicateGroups">
            <div nested-panels>
              <app-panel
                [elements]="subPeerReview"
                [type]="'top-bar'"
                [editable]="false"
                [customControls]="true"
                class="top-bar"
              >
                <div header>
                  <span class="header-sub-peer-review">
                    <b i18n="@@peerReview.reviewDate">
                      Review date:
                    </b>
                    {{subPeerReview.peerReviews[0].completionDate | monthDayYearDateToString}}
                  </span>
                  <span class="header-sub-peer-review">
                    <b i18n="@@peerReview.type">
                      Type:
                    </b>
                    <span class="capitalize">
                      {{subPeerReview.peerReviews[0].type.value}}
                    </span>
                  </span>
                  <span class="header-sub-peer-review">
                    <b i18n="@@peerReview.role">
                      Role:
                    </b>
                    <span class="capitalize">
                      {{subPeerReview.peerReviews[0].role.value}}
                    </span>
                  </span>
                </div>
                <div custom-controls>
                  <span class="show">
                    <a
                      *ngIf="!subPeerReview.peerReviews[0].showDetails"
                      (click)="getDetails(subPeerReview.peerReviews[0], subPeerReview.peerReviews[0].putCode.value)"
                      i18n="@@peerReview.showMoreDetail"
                    >
                      Show more detail
                    </a>
                    <a
                      *ngIf="subPeerReview.peerReviews[0].showDetails"
                      (click)="collapse(subPeerReview.peerReviews[0])"
                      i18n="@@peerReview.showLessDetail"
                    >
                      Show less detail
                    </a>
                  </span>
                  <a
                    rel="noopener noreferrer"
                    target="_blank"
                    href="{{subPeerReview.peerReviews[0].url}}"
                    i18n="@@peerReview.view"
                  >
                    View
                  </a>
                </div>
                <app-panel-data *ngIf="subPeerReview.peerReviews[0].showDetails">
                  <app-panel-element
                    [hideVisibility]="false">
                    <div class="details">
                      <div>
                        <b i18n="@@peerReview.reviewIdentifiers">Review identifier(s)</b>
                      </div>
                      <span class="source">
                        {{subPeerReview.peerReviews[0].externalIdentifiers[0].externalIdentifierType.value}}: {{subPeerReview.peerReviews[0].externalIdentifiers[0].externalIdentifierId.value}}
                      </span>
                    </div>
                    <div class="details">
                      <div>
                        <b i18n="@@peerReview.conveningOrganization">
                          Convening organization
                        </b>
                      </div>
                      {{ getPeerReview(subPeerReview.peerReviews[0].putCode.value).orgName.value }}
                    </div>
                    <div>
                      <b i18n="@@peerReview.reviewSubject">
                        Review subject
                      </b>
                    </div>
                    <div>
                      <ng-container *ngIf="getPeerReview(subPeerReview.peerReviews[0].putCode.value).subjectName">
                        {{ getPeerReview(subPeerReview.peerReviews[0].putCode.value).subjectName.value }}
                      </ng-container>
                      <ng-container *ngIf="getPeerReview(subPeerReview.peerReviews[0].putCode.value).subjectType">
                        ({{ getPeerReview(subPeerReview.peerReviews[0].putCode.value).subjectType.value }})
                      </ng-container>
                    </div>
                    <div *ngIf="getPeerReview(subPeerReview.peerReviews[0].putCode.value).subjectContainerName">
                      {{ getPeerReview(subPeerReview.peerReviews[0].putCode.value).subjectContainerName.value }}
                    </div>
                  </app-panel-element>
                </app-panel-data>
              </app-panel>
            </div>
          </ng-container>
        </app-panel-element>
      </app-panel-data>
      <app-panel-source [sourceName]="peerReview.sourceName">
      </app-panel-source>
    </app-panel>
  </ng-container>
</app-panels>
