<app-modal [loading]="loading">
  <app-modal-header>
    <ng-container i18n="@@work.works"> Works </ng-container>
  </app-modal-header>
  <app-modal-side-bar>
    <ng-container id="side-bar-title">
      <a class="side-bar" i18n="@@topBar.biography" (click)="toWorkDetails()">
        Work Details
      </a>
    </ng-container>
    <ng-container id="side-bar-url-1">
      <a class="side-bar" i18n="@@shared.visibility" (click)="toIdentifiers()">
        Identifiers
      </a>
    </ng-container>
    <ng-container id="side-bar-url-2">
      <a class="side-bar" i18n="@@shared.visibility" (click)="toCitation()">
        Citation
      </a>
    </ng-container>
    <ng-container id="side-bar-url-3">
      <a
        class="side-bar"
        i18n="@@shared.visibility"
        (click)="toOtherInformation()"
      >
        Other information
      </a>
    </ng-container>
    <ng-container id="side-bar-url-4">
      <a class="side-bar" i18n="@@shared.visibility" (click)="toVisibility()">
        Visibility
      </a>
    </ng-container>
  </app-modal-side-bar>
  <app-modal-footer>
    <button
      mat-raised-button
      color="primary"
      (click)="saveEvent()"
      i18n="@@shared.saveChanges"
      id="save-work-button"
    >
      Save changes
    </button>
    <button
      mat-stroked-button
      color="primary"
      (click)="closeEvent()"
      i18n="@@shared.cancel"
      id="cancel-work-button"
    >
      Cancel
    </button>
  </app-modal-footer>
  <form [formGroup]="workForm" *ngIf="workForm">
    <div
      id="workDetails"
      class="title row"
      [ngClass]="{
        'orc-font-body': !platform.columns12,
        'orc-font-body-large': platform.columns12
      }"
    >
      <p>
        <strong i18n="@@topBar.biography"> Work details </strong>
      </p>
      <p *ngIf="platform.columns12" class="required-information mat-caption">
        <span class="required">*</span>
        <ng-container i18n="@@shared.requiredInformation"
          >Required information</ng-container
        >
      </p>
    </div>
    <hr />

    <!-- Work Category -->
    <div>
      <div class="row">
        <label
          for="given-names-input"
          class="mat-caption title"
          [ngClass]="{
            error:
              workForm.get('workCategory').hasError('required') &&
              workForm.get('workCategory').touched
          }"
        >
          <strong i18n="@@topBar.givenNames">Select a work category</strong>
          <span class="required">*</span>
        </label>
      </div>

      <div class="row">
        <mat-form-field appearance="outline" class="mat-form-field-min">
          <mat-select formControlName="workCategory" name="item">
            <mat-option
              *ngFor="let item of workCategories | keyvalue"
              [value]="item.value"
            >
              {{ item.value | recordWorkCategoryLabel }}
            </mat-option>
          </mat-select>
          <mat-error
            *ngIf="workForm.get('workCategory').hasError('required')"
            i18n="@@topBar.invalidBio"
          >
            Invalid characters or format
          </mat-error>
        </mat-form-field>
      </div>
    </div>
    <!-- Work Types -->
    <div [ngClass]="{ hide: (workTypes | keyvalue).length === 0 }">
      <label
        class="row"
        for="given-names-input"
        class="mat-caption"
        [ngClass]="{
          error:
            workForm.get('workType').hasError('required') &&
            workForm.get('workType').touched
        }"
      >
        <strong i18n="@@topBar.givenNames">Work type</strong>
        <span class="required">*</span>
      </label>
      <mat-form-field appearance="outline" class="mat-form-field-min row">
        <mat-select
          placeholder="Select a work type"
          formControlName="workType"
          name="item"
        >
          <mat-option
            *ngFor="let item of workTypes | keyvalue"
            [value]="item.value"
          >
            {{ item.value | recordWorkTypeLabel }}
          </mat-option>
        </mat-select>
        <mat-error
          *ngIf="workForm.get('workType').hasError('required')"
          i18n="@@topBar.invalidBio"
        >
          Invalid characters or format
        </mat-error>
      </mat-form-field>
    </div>
    <!-- Title -->

    <div>
      <div class="row">
        <label
          for="given-names-input"
          class="mat-caption"
          [ngClass]="{
            error:
              workForm.hasError('required', 'title') &&
              workForm.get('title').touched
          }"
        >
          <strong i18n="@@topBar.givenNames">Title</strong>
          <span class="required">*</span>
        </label>
      </div>

      <mat-form-field appearance="outline" class="mat-form-field-min">
        <input id="biography-input" matInput formControlName="title" />
        <mat-error
          *ngIf="workForm.get('title').hasError('required')"
          i18n="@@topBar.invalidBio"
        >
          Invalid characters or format
        </mat-error>
      </mat-form-field>
    </div>
    <!-- SHOW-HIDE translated title button  -->
    <div>
      <div
        class="row translate-title"
        *ngIf="!showTranslationTitle"
        (click)="showTranslationTitle = !showTranslationTitle"
      >
        <button mat-icon-button color="primary">
          <mat-icon>add</mat-icon>
        </button>
        <a>add translated title</a>
      </div>

      <div
        class="row"
        *ngIf="showTranslationTitle"
        (click)="showTranslationTitle = !showTranslationTitle"
      >
        <button mat-icon-button><mat-icon>add</mat-icon></button>
        <a>Hide translation title</a>
      </div>
    </div>

    <!-- Work translations title -->
    <div [hidden]="!showTranslationTitle">
      <div>
        <div class="row">
          <label
            for="given-names-input"
            class="mat-caption"
            [ngClass]="{
              error:
                workForm.hasError('required', 'translatedTitleContent') &&
                workForm.get('translatedTitleContent').touched
            }"
          >
            <strong i18n="@@topBar.givenNames">Work translated title</strong>
          </label>
        </div>

        <mat-form-field appearance="outline" class="mat-form-field-min">
          <input
            id="biography-input"
            matInput
            formControlName="translatedTitleContent"
          />
          <mat-error
            *ngIf="workForm.get('translatedTitleContent').hasError('required')"
            i18n="@@topBar.invalidBio"
          >
            Invalid characters or format
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Language of this title -->
      <div>
        <div class="row">
          <label
            for="given-names-input"
            class="mat-caption"
            [ngClass]="{
              error:
                workForm.hasError('required', 'translatedTitleLanguage') &&
                workForm.get('translatedTitleLanguage').touched
            }"
          >
            <strong i18n="@@topBar.givenNames">Language of this title</strong>
          </label>
        </div>
        <div class="row">
          <mat-form-field appearance="outline" class="mat-form-field-min">
            <mat-select
              placeholder="Select a language"
              formControlName="translatedTitleLanguage"
              name="item"
            >
              <mat-option
                *ngFor="let item of languageMap | keyvalue"
                [value]="item.key"
              >
                {{ item.value }}
              </mat-option>
            </mat-select>
            <mat-error
              *ngIf="
                workForm.get('translatedTitleLanguage').hasError('required')
              "
              i18n="@@topBar.invalidBio"
            >
              Invalid characters or format
            </mat-error>
          </mat-form-field>
        </div>
      </div>
    </div>

    <!-- Work subtitle -->

    <div>
      <div class="row">
        <label
          for="given-names-input"
          class="mat-caption"
          [ngClass]="{
            error:
              workForm.hasError('required', 'subtitle') &&
              workForm.get('subtitle').touched
          }"
        >
          <strong i18n="@@topBar.givenNames">Work Subtitle</strong>
        </label>
      </div>

      <mat-form-field appearance="outline" class="mat-form-field-min">
        <input id="biography-input" matInput formControlName="subtitle" />
        <mat-error
          *ngIf="workForm.get('subtitle').hasError('required')"
          i18n="@@topBar.invalidBio"
        >
          Invalid characters or format
        </mat-error>
      </mat-form-field>
    </div>
    <!-- Journal title -->

    <div>
      <div class="row">
        <label
          for="given-names-input"
          class="mat-caption"
          [ngClass]="{
            error:
              workForm.hasError('required', 'journalTitle') &&
              workForm.get('journalTitle').touched
          }"
        >
          <strong i18n="@@topBar.givenNames">{{ dynamicTitle }}</strong>
        </label>
      </div>

      <mat-form-field appearance="outline" class="mat-form-field-min">
        <input id="biography-input" matInput formControlName="journalTitle" />
        <mat-error
          *ngIf="workForm.get('journalTitle').hasError('required')"
          i18n="@@topBar.invalidBio"
        >
          Invalid characters or format
        </mat-error>
      </mat-form-field>
    </div>
    <!-- Publication date -->
    <div>
      <div class="row">
        <label
          for="given-names-input"
          class="mat-caption"
          [ngClass]="{
            error:
              workForm.hasError('required', 'publicationDateYear') &&
              workForm.get('publicationDateYear').touched
          }"
        >
          <strong i18n="@@topBar.givenNames">Publication Date</strong>
          <span class="required">*</span>
        </label>
      </div>
      <div class="row date-container">
        <mat-form-field appearance="outline" class="mat-form-field-min">
          <mat-select
            placeholder="Year"
            formControlName="publicationDateYear"
            name="item"
          >
            <mat-option
              *ngFor="let item of yearOptions | keyvalue"
              [value]="item.key"
            >
              {{ item.value }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="mat-form-field-min">
          <mat-select
            placeholder="Month"
            formControlName="publicationDateMonth"
            name="item"
          >
            <mat-option
              *ngFor="let item of monthOptions | keyvalue"
              [value]="item.key"
            >
              {{ item.value }}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline" class="mat-form-field-min">
          <mat-select
            placeholder="Day"
            formControlName="publicationDateDay"
            name="item"
          >
            <mat-option
              *ngFor="let item of dayOptions | keyvalue"
              [value]="item.key"
            >
              {{ item.value }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <!-- Work url -->

    <div>
      <div class="row">
        <label
          for="given-names-input"
          class="mat-caption"
          [ngClass]="{
            error:
              workForm.hasError('required', 'url') &&
              workForm.get('url').touched
          }"
        >
          <strong i18n="@@topBar.givenNames">Link</strong>
        </label>
      </div>

      <mat-form-field appearance="outline" class="mat-form-field-min">
        <input id="biography-input" matInput formControlName="url" />
        <mat-error
          *ngIf="workForm.get('url').hasError('required')"
          i18n="@@topBar.invalidBio"
        >
          Invalid characters or format
        </mat-error>
        <mat-hint
          >A link to more information about the work. Links should be in the
          full URL format e.g. http://www.website.com/page.html
        </mat-hint>
      </mat-form-field>
    </div>

    <!------------------->
    <!-- Work Citation -->
    <!------------------->

    <div
      class="title"
      id="citation"
      [ngClass]="{
        'orc-font-body': !platform.columns12,
        'orc-font-body-large': platform.columns12
      }"
    >
      <p>
        <strong i18n="@@shared.visibility"> Citation </strong>
      </p>
    </div>

    <hr />

    <!-- Citation type -->

    <div>
      <div class="row">
        <label
          for="given-names-input"
          class="mat-caption"
          [ngClass]="{
            error:
              workForm.hasError('required', 'citationType') &&
              workForm.get('citationType').touched
          }"
        >
          <strong i18n="@@topBar.givenNames">Citation type</strong>
        </label>
      </div>
      <div class="row">
        <mat-form-field appearance="outline" class="mat-form-field-min">
          <mat-select
            placeholder="Placeholder"
            formControlName="citationType"
            name="item"
          >
            <mat-option [value]="''"> Select a citation type </mat-option>

            <mat-option
              *ngFor="let item of citationTypes | keyvalue"
              [value]="item.key"
            >
              {{ item.value }}
            </mat-option>

            <mat-option
              *ngFor="let item of citationTypes | keyvalue"
              [value]="item.key"
            >
              {{ item.value }}
            </mat-option>
          </mat-select>
          <mat-error
            *ngIf="workForm.get('citationType').hasError('required')"
            i18n="@@topBar.invalidBio"
          >
            Invalid characters or format
          </mat-error>
        </mat-form-field>
      </div>
    </div>
    <!-- Citation  -->

    <div>
      <div class="row">
        <label
          for="given-names-input"
          class="mat-caption"
          [ngClass]="{
            error:
              workForm.hasError('required', 'citation') &&
              workForm.get('citation').touched
          }"
        >
          <strong i18n="@@topBar.givenNames">Citation</strong>
          <span class="required">*</span>
        </label>
      </div>
      <mat-form-field appearance="outline" class="mat-form-field-min">
        <textarea
          matInput
          formControlName="citation"
          cdkTextareaAutosize
          cdkAutosizeMinRows="5"
          cdkAutosizeMaxRows="7"
        ></textarea>
        <mat-error *ngIf="workForm.hasError('required', 'citation')">
          Invalid characters or format
        </mat-error>
      </mat-form-field>
    </div>
    <!-- Description  -->

    <div>
      <div class="row">
        <label
          for="given-names-input"
          class="mat-caption"
          [ngClass]="{
            error:
              workForm.hasError('required', 'shortDescription') &&
              workForm.get('shortDescription').touched
          }"
        >
          <strong i18n="@@topBar.givenNames">Description</strong>
          <span class="required">*</span>
        </label>
      </div>
      <mat-form-field appearance="outline" class="mat-form-field-min biography">
        <textarea
          id="biography-input"
          matInput
          formControlName="shortDescription"
          cdkTextareaAutosize
          cdkAutosizeMinRows="5"
          cdkAutosizeMaxRows="7"
        >
        </textarea>
        <mat-error
          *ngIf="workForm.get('shortDescription').hasError('notPattern')"
          i18n="@@topBar.invalidBio"
        >
          Invalid characters or format
        </mat-error>
      </mat-form-field>
    </div>

    <!---------------------->
    <!-- Work Identifiers -->
    <!---------------------->

    <div
      class="title"
      id="identifiers"
      [ngClass]="{
        'orc-font-body': !platform.columns12,
        'orc-font-body-large': platform.columns12
      }"
    >
      <p>
        <strong i18n="@@shared.visibility"> Work identifiers</strong>
      </p>
    </div>
    <hr />

    <div formArrayName="workIdentifiers">
      <ng-container
        *ngFor="
          let workIdentifiersGroup of workIdentifiersArray.controls;
          let i = index;
          let last = last
        "
      >
        <ng-container [formGroupName]="i">
          <!-- Work identifier type -->
          <div>
            <div class="row">
              <label
                for="given-names-input"
                class="mat-caption"
                [ngClass]="{
                  error:
                    workIdentifiersGroup.hasError(
                      'required',
                      'externalIdentifierType'
                    ) &&
                    workIdentifiersGroup.get('externalIdentifierType').touched
                }"
              >
                <strong i18n="@@topBar.givenNames">Identifier type</strong>
                <span class="required">*</span>
              </label>
            </div>
            <div class="row">
              <mat-form-field appearance="outline" class="mat-form-field-min">
                <mat-select
                  placeholder="Placeholder"
                  formControlName="externalIdentifierType"
                  name="item"
                >
                  <mat-option [value]="''">
                    Select an identifier type
                  </mat-option>

                  <mat-option
                    *ngFor="let item of workIdTypes"
                    [value]="item.name"
                  >
                    {{ item.description }}
                  </mat-option>

                  <mat-error
                    *ngIf="
                      workIdentifiersGroup
                        .get('externalIdentifierType')
                        .hasError('required')
                    "
                    i18n="@@topBar.invalidBio"
                  >
                    Invalid characters or format
                  </mat-error>
                  <mat-hint
                    >The type of identifier associated with the work, such as an
                    ISBN, DOI or PMID.
                  </mat-hint>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
          <!-- Work identifier value -->

          <div>
            <div class="row">
              <label
                for="given-names-input"
                class="mat-caption"
                [ngClass]="{
                  error:
                    workIdentifiersGroup.hasError(
                      'required',
                      'externalIdentifierId'
                    ) &&
                    workIdentifiersGroup.get('externalIdentifierId').touched
                }"
              >
                <strong i18n="@@topBar.givenNames">Identifier value </strong>
                <span class="required">*</span>
              </label>
            </div>
            <mat-form-field appearance="outline" class="mat-form-field-min">
              <input
                id="biography-input"
                matInput
                formControlName="externalIdentifierId"
              />
              <mat-error
                *ngIf="
                  workIdentifiersGroup
                    .get('externalIdentifierId')
                    .hasError('required')
                "
                i18n="@@topBar.invalidBio"
              >
                Invalid characters or format
              </mat-error>
              <mat-hint
                >The identifier associated with the work. The format will depend
                on the type of identifier selected.
              </mat-hint>
            </mat-form-field>
          </div>
          <!-- Work identifier url value -->

          <div class="row">
            <label
              for="given-names-input"
              class="mat-caption"
              [ngClass]="{
                error:
                  workIdentifiersGroup.hasError(
                    'pattern',
                    'externalIdentifierUrl'
                  ) && workIdentifiersGroup.get('externalIdentifierUrl').touched
              }"
            >
              <strong i18n="@@topBar.givenNames">Identifier URL </strong>
              <span class="required">*</span>
            </label>

            <mat-form-field appearance="outline" class="mat-form-field-min">
              <input
                id="biography-input"
                matInput
                formControlName="externalIdentifierUrl"
              />

              <mat-hint>
                The URL that the identifier resolves to, for example
                https://doi.org/10.23640/07243.c.4232246
              </mat-hint>
              <mat-error
                *ngIf="
                  workIdentifiersGroup
                    .get('externalIdentifierUrl')
                    .hasError('pattern')
                "
                i18n="@@topBar.invalidBio"
              >
                Invalid characters or format
              </mat-error>
            </mat-form-field>
          </div>

          <!-- Work identifier relationship -->

          <div>
            <div class="row">
              <label
                for="given-names-input"
                class="mat-caption"
                [ngClass]="{
                  error:
                    workIdentifiersGroup.hasError(
                      'required',
                      'externalRelationship'
                    ) &&
                    workIdentifiersGroup.get('externalRelationship').touched
                }"
              >
                <strong i18n="@@topBar.givenNames">Relationship</strong>
                <span class="required">*</span>
              </label>
            </div>

            <mat-radio-group
              aria-label="Select an option"
              appearance="outline"
              class="mat-form-field-min"
              formControlName="externalRelationship"
            >
              <mat-radio-button
                *ngFor="let value of workRelationships"
                [value]="value"
                >{{ value }}
              </mat-radio-button>
            </mat-radio-group>

            <button
              mat-icon-button
              (click)="deleteWorkId(i)"
              *ngIf="workIdentifiersArray.controls.length > 1"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </ng-container>

        <hr *ngIf="!last" />
      </ng-container>

      <!-- Add other identifier  -->
      <div class="row" *ngIf="!showTranslationTitle" (click)="addOtherWorkId()">
        <button mat-icon-button><mat-icon>add</mat-icon></button>
        <a>Add other identifier</a>
      </div>
    </div>

    <!---------------------->
    <!-- Work Other Information -->
    <!---------------------->

    <div
      class="title"
      id="otherInformation"
      [ngClass]="{
        'orc-font-body': !platform.columns12,
        'orc-font-body-large': platform.columns12
      }"
    >
      <p>
        <strong i18n="@@shared.visibility"> Other information</strong>
      </p>
    </div>
    <hr />

    <!-- Language of this form -->
    <div>
      <div class="row">
        <label for="given-names-input" class="mat-caption">
          <strong i18n="@@topBar.givenNames">Language used in this form</strong>
        </label>
      </div>
      <div class="row">
        <mat-form-field appearance="outline" class="mat-form-field-min">
          <mat-select
            placeholder="Placeholder"
            formControlName="languageCode"
            name="item"
          >
            <mat-option
              *ngFor="let item of languageMap | keyvalue"
              [value]="item.key"
            >
              {{ item.value }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <!-- Country of publication -->
    <div>
      <div class="row">
        <label for="given-names-input" class="mat-caption">
          <strong i18n="@@topBar.givenNames">Country of publication</strong>
        </label>
      </div>
      <div class="row">
        <mat-form-field appearance="outline" class="mat-form-field-min">
          <mat-select
            placeholder="Placeholder"
            formControlName="languageCode"
            name="item"
          >
            <mat-option
              *ngFor="let item of languageMap | keyvalue"
              [value]="item.key"
            >
              {{ item.value }}
            </mat-option>
          </mat-select>
          <mat-error
            *ngIf="workForm.get('languageCode').hasError('required')"
            i18n="@@topBar.invalidBio"
          >
            Invalid characters or format
          </mat-error>
        </mat-form-field>
      </div>
    </div>

    <!---------------------->
    <!-- Work Visibility -->
    <!---------------------->

    <div
      id="visibility"
      class="title"
      [ngClass]="{
        'orc-font-body': !platform.columns12,
        'orc-font-body-large': platform.columns12
      }"
    >
      <p>
        <strong i18n="@@shared.visibility"> Visibility </strong>
      </p>
    </div>
    <hr />

    <!-- Work Visibility -->
    <div>
      <p class="orc-font-small-print" i18n="@@shared.whoCanSeeWork">
        Manage who can see this information in your record.
      </p>
      <div class="col no-wrap actions-wrapper no-gutters visibility">
        <app-privacy-selector
          formControlName="visibility"
        ></app-privacy-selector>
      </div>
    </div>
  </form>
</app-modal>
