<app-modal noSidebar="true">
  <app-modal-header>Emails</app-modal-header>
  <app-modal-footer>
    <button
      mat-raised-button
      color="primary"
      (click)="saveEvent()"
      [disabled]="!this.emailsForm.valid"
    >
      Save changes
    </button>
    <button mat-stroked-button color="primary" (click)="closeEvent()">
      Cancel
    </button>
  </app-modal-footer>

  <div class="container" [formGroup]="emailsForm">
    <div class="row">
      <div class="col">
        <p>ORCID works best when you have multiple email addresses.</p>
        <p>
          Per the ORCID <a href="/content/orcid-terms-use">terms of use</a> you
          may only add email addresses that you have control over. Each time you
          add an email address we will send you an email asking you to verify
          it.
        </p>
      </div>
    </div>
    <div class="row">
      <h3 class="col">Primary email address</h3>
    </div>

    <!-- PRIMARY EMAIL -->
    <div class="row">
      <ng-container *ngFor="let email of emails">
        <div
          *ngIf="email.primary"
          class="row email-input-line"
          [formGroupName]="email.putCode"
        >
          <div class="col l12 m8 s4 email-input-container">
            <mat-form-field
              *ngIf="!showEmailAsVerified(email)"
              appearance="outline"
              class="mat-form-field-min verify-icon email-activated"
            >
              <input matInput matInput formControlName="email" />
              <mat-icon matPrefix>verified</mat-icon>
            </mat-form-field>

            <strong
              class="orc-font-body-large email-activated primary-email-label verify-icon"
              *ngIf="showEmailAsVerified(email)"
            >
              <mat-icon class="title-material-icon" matPrefix
                >verified</mat-icon
              >
              {{ emailsForm.value[email.putCode].email }}</strong
            >
          </div>
          <div class="col actions-wrapper no-gutters">
            <div class="actions-sub-wrapper"></div>
            <div class="actions-sub-wrapper">
              <app-privacy-selector
                formControlName="visibility"
              ></app-privacy-selector>
              <div></div>
            </div>
          </div>
        </div>
        <app-alert-message
          *ngIf="email.primary && !showEmailAsVerified(email)"
          class="orc-font-body-small"
        >
          <strong class="orc-font-body"
            >Please verify your primary email address!</strong
          >

          <p>
            You need to verify your primary email in order to access all of
            ORCID’s editing features. <br />
            To verify your email, click the link in the message sent to:
          </p>
          <p class="email-container">{{ email.value }}</p>

          <p>
            <strong> Need help?</strong> <br />
            Visit our
            <a href="https://support.orcid.org/hc/articles/360006973793"
              >knowledge</a
            >
            base or contact
            <a href="https://support.orcid.org/hc/en-us/requests/new">
              contact support.
            </a>
          </p>
        </app-alert-message>
      </ng-container>
    </div>

    <div class="row">
      <h3 class="col">Other email address</h3>
    </div>

    <!-- ADDITIONAL EMAILS -->

    <ng-container *ngFor="let email of emails">
      <div
        *ngIf="!email.primary"
        class="row email-input-line"
        [formGroupName]="email.putCode"
      >
        <div class="col l12 m8 s4 email-input-container">
          <mat-form-field
            appearance="outline"
            class="mat-form-field-min verify-icon"
            [ngClass]="{
              'email-activated': showEmailAsVerified(email)
            }"
          >
            <input #emailInput matInput formControlName="email" />
            <mat-icon matPrefix>verified</mat-icon>
            <mat-error
              *ngIf="
                emailsForm.hasError('backendErrors', [email.putCode, 'email'])
              "
            >
              This email already exists in our system.
            </mat-error>
            <mat-error
              *ngIf="
                emailsForm.hasError('duplicated', [email.putCode, 'email'])
              "
            >
              Additional emails can not be duplicated
            </mat-error>
            <mat-error
              *ngIf="emailsForm.hasError('email', [email.putCode, 'email'])"
            >
              Invalid email format
            </mat-error>

            <mat-error
              *ngIf="
                emailsForm.hasError('backendError', [email.putCode, 'email'])
              "
            >
              This email is already associated with an ORCID record.
            </mat-error>
          </mat-form-field>
        </div>

        <div class="col actions-wrapper no-gutters">
          <div class="actions-sub-wrapper">
            <a
              class="orc-font-smallprint"
              *ngIf="showEmailAsVerified(email)"
              (click)="makePrimary(email)"
            >
              Make primary</a
            >

            <ng-container *ngIf="showNonVerifiedData(email)">
              <a
                class="orc-font-smallprint disabled"
                *ngIf="verificationEmailWasSend(email)"
              >
                Resend verification email</a
              >
              <a
                class="orc-font-smallprint"
                (click)="verifyEmail(email)"
                *ngIf="!verificationEmailWasSend(email)"
              >
                Resend verification email</a
              >
            </ng-container>
          </div>

          <div class="actions-sub-wrapper">
            <app-privacy-selector
              formControlName="visibility"
            ></app-privacy-selector>
            <button
              (click)="deleteEmail(email.putCode)"
              mat-icon-button
              class="delete-button"
            >
              <mat-icon class="material-icons-outlined huge-material-icon"
                >delete</mat-icon
              >
            </button>
          </div>
        </div>
        <hr *ngIf="isMobile" />
      </div>
      <div class="col l12 m8 s4">
        <app-alert-message
          *ngIf="verificationEmailWasSend(email)"
          class="orc-font-body-small"
        >
          <strong class="orc-font-body"
            >We’ve sent a verification email to {{ email.value }}</strong
          >
          <p>
            Please check your email inbox (or maybe your spam folder) for an
            email with a link to complete the process.
          </p>
        </app-alert-message>
      </div>
    </ng-container>

    <div class="row">
      <a class="col add-more" (click)="addEmail()">
        <mat-icon class="large-material-icon">add_circle_outline </mat-icon> Add
        another email address</a
      >
    </div>
  </div>
</app-modal>
